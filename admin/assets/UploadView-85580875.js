import{d as V,c as d,a as e,t as l,F as b,e as x,f as $,o as s,g as q,u as A,r as k,w as M,b as N,h as P}from"./index-2d9bbdad.js";import{_ as R}from"./ValidationCharts.vue_vue_type_script_setup_true_lang-c388b82b.js";const L={key:0,class:"mx-auto w-full max-w-screen-lg table-fixed"},O={class:"border-b border-black"},G={class:"border-b border-black"},H=["href"],K={class:"flex flex-row items-center gap-2"},Q=["id","checked","disabled","value"],W=["for"],X=["href"],Y={key:0},Z=["href"],J={key:0},ee={key:0,class:"inline h-6 align-bottom text-green-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},te=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),oe=[te],ne={key:1,class:"inline h-6 align-bottom text-blue-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},ae=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),le=[ae],se={key:1,class:"inline h-6 align-bottom text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},re=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),de=[re],ie={key:1,class:"border-b border-black"},ue=e("td",null,null,-1),ce=e("td",null,null,-1),he=V({__name:"UploadReport",props:{json:{},language:{}},setup(D){const r=D,E="https://who-admin-backend.azurewebsites.net/api/download?path=";return(g,U)=>g.json.length>0?(s(),d("table",L,[e("thead",null,[e("tr",O,[e("th",null,l(g.$t("folder")),1),e("th",null,l(g.$t("main-file")),1),e("th",null,l(g.$t("child-file")),1)])]),e("tbody",null,[(s(!0),d(b,null,x(g.json,h=>(s(),d(b,null,[h.children.length>0?(s(!0),d(b,{key:0},x(h.children,f=>(s(),d("tr",G,[e("td",null,l(h.path),1),e("td",null,[e("a",{href:E+encodeURIComponent(f.path)+"&language="+r.language,target:"_blank",class:"text-blue-who"},l(f.name),9,H)]),e("td",null,[(s(!0),d(b,null,x(f.split,t=>{var m,v,y,C,j,S,T,n,a,o;return s(),d("div",K,[e("input",{type:"checkbox",id:t.path,class:"rounded text-blue-who focus:ring-0 disabled:opacity-50",checked:((v=(m=t.converted[0])==null?void 0:m.errors.validationErrors)==null?void 0:v.length)+((C=(y=t.converted[0])==null?void 0:y.errors.semanticErrors)==null?void 0:C.length)==0,disabled:t.converted.length==0,value:(j=t.converted[0])==null?void 0:j.path},null,8,Q),e("label",{for:t.path},[e("a",{href:E+encodeURIComponent(t.path)+"&language="+r.language,target:"_blank",class:"text-blue-who"},l(t.name),9,X),(S=t.converted[0])!=null&&S.name?(s(),d("span",Y,[q(" - "),e("a",{href:E+encodeURIComponent(t.converted[0].path)+"&language="+r.language,target:"_blank",class:"text-blue-who"},l(t.converted[0].name),9,Z),((T=t.converted[0].errors.validationErrors)==null?void 0:T.length)==0||((n=t.converted[0].errors.semanticErrors)==null?void 0:n.length)==0?(s(),d("span",J,[((a=t.converted[0].errors.validationErrors)==null?void 0:a.length)==0?(s(),d("svg",ee,oe)):$("",!0),((o=t.converted[0].errors.semanticErrors)==null?void 0:o.length)==0?(s(),d("svg",ne,le)):$("",!0)])):t.converted[0].errors.validationErrors?(s(),d("svg",se,de)):$("",!0)])):$("",!0)],8,W)])}),256))])]))),256)):(s(),d("tr",ie,[e("td",null,l(h.path),1),ue,ce]))],64))),256))])])):$("",!0)}}),pe={class:"text-center text-3xl font-bold"},be=["onSubmit"],ge={for:"documents"},fe=e("input",{class:"file:cursor-pointer file:rounded file:border-2 file:border-solid file:border-blue-who file:bg-blue-who file:px-5 file:py-1 file:font-bold file:text-white file:duration-200 file:ease-in-out file:hover:bg-white file:hover:text-blue-who",type:"file",id:"documents",name:"documents",accept:".zip",required:""},null,-1),me={for:"format"},ve={id:"format",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"format",required:""},we=["value"],_e={for:"language"},$e={id:"language",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"language",required:""},ye=e("option",{value:""},null,-1),ke=["value"],xe={for:"doctype"},Ee={id:"doctype",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"doctype",required:""},Ce=["value"],Fe={class:"flex flex-row items-center gap-2"},Be=e("input",{type:"checkbox",id:"split",class:"rounded text-blue-who focus:ring-0",name:"split",value:"true"},null,-1),je={for:"split"},Se=["disabled","value"],Te={class:"mx-auto max-w-screen-lg"},Ie={key:0,class:"flex flex-row justify-center gap-2 p-4"},ze=["disabled"],Ve=V({__name:"UploadView",setup(D){const{t:r}=A(),E={akn:"Akoma Ntoso"},g={ara:"العربية",deu:"Deutsch",eng:"English",spa:"Español",fre:"Français",por:"Português",rsu:"Русский",zho:"中文"},U={statement:"Statement"},h=k([]),f=k(""),t=k(r("upload")),m=k(r("save")),v=k(!1),y=k([]);function C(n){[...document.querySelectorAll("table input[type=checkbox]:not(:disabled)")].forEach(a=>a.checked=n)}function j(n){const a=[...document.querySelectorAll("table input[type=checkbox]:checked")].map(o=>o.value);if(a.length==0)alert(r("no-file-selected"));else{m.value=r("saving");const o=new FormData;o.append("path",a.toString()),o.append("language",f.value),fetch("https://who-admin-backend.azurewebsites.net/api/save",{method:"POST",body:o}).then(i=>{i.ok?alert(r("saving-completed")):i.json().then(w=>{alert(`${r("error-during-saving")}: ${w.message}`)}),m.value=r("save")})}}async function S(n,a,o){let i=0,w=0,I=0,_=0;h.value.forEach(F=>{F.children.forEach(B=>{w++})}),t.value=`${r("splitting")} (0/${w})`;for(const F of h.value)for(const B of F.children){const p=new FormData;p.append("path",B.path),p.append("language",a),await fetch("https://who-admin-backend.azurewebsites.net/api/split",{method:"POST",body:p}).then(u=>(i++,t.value=`${r("splitting")} (${i}/${w})`,u.ok?u.json():u.json().then(c=>{throw new Error(`Code: ${c.code}`)}))).then(u=>{_+=u.length,B.split=u}).catch(u=>{console.log(u)})}t.value=`${r("converting")} (0/${_})`;for(const F of h.value)for(const B of F.children)for(const p of B.split){const u=new FormData;u.append("path",p.path),u.append("to",n),u.append("language",a),u.append("doctype",o),await fetch("https://who-admin-backend.azurewebsites.net/api/convert",{method:"POST",body:u}).then(c=>c.json()).then(c=>{I++,t.value=`${r("converting")} (${I}/${_})`,c.code?console.error(`${p.path}: ${c.code} (${c.message})`):(p.converted.push(c),fetch("https://who-admin-backend.azurewebsites.net/api/validate?path="+encodeURIComponent(c.path)+"&language="+a).then(z=>z.json()).then(z=>{p.converted[0].errors=z.errors,y.value.push({name:c.name,path:c.path,errors:z.errors})}))}).catch(c=>{console.log(c)})}t.value=r("upload"),v.value=!0}function T(n){t.value=r("uploading"),v.value=!1,y.value=[];const a=new FormData(n.target);a.delete("format"),a.delete("split");const o=document.getElementById("format").value,i=document.getElementById("language").value;f.value=i,localStorage.documentsLanguage=i;const w=document.getElementById("doctype").value,I=document.getElementById("split").checked;fetch("https://who-admin-backend.azurewebsites.net/api/upload",{method:"POST",body:a}).then(_=>_.json()).then(_=>{h.value=_,I?S(o,i,w):t.value=r("upload")})}return(n,a)=>(s(),d(b,null,[e("h1",pe,l(n.$t("upload")),1),e("form",{class:"mx-auto flex max-w-md flex-col gap-2 p-4",onSubmit:M(T,["prevent"])},[e("label",ge,l(n.$t("documents")),1),fe,e("label",me,l(n.$t("upload-format")),1),e("select",ve,[(s(),d(b,null,x(E,(o,i)=>e("option",{key:`format-${i}`,value:i},l(o),9,we)),64))]),e("label",_e,l(n.$t("upload-language")),1),e("select",$e,[ye,(s(),d(b,null,x(g,(o,i)=>e("option",{key:`language-${o}`,value:i},l(o),9,ke)),64))]),e("label",xe,l(n.$t("upload-doctype")),1),e("select",Ee,[(s(),d(b,null,x(U,(o,i)=>e("option",{key:`doctype-${i}`,value:i},l(o),9,Ce)),64))]),e("div",Fe,[Be,e("label",je,l(n.$t("upload-split")),1)]),e("input",{class:"mx-auto rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:t.value!=n.$t("upload"),type:"submit",value:t.value},null,8,Se)],40,be),e("div",Te,[N(he,{json:h.value,language:f.value},null,8,["json","language"]),v.value?(s(),d("div",Ie,[e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:a[0]||(a[0]=o=>C(!0))},l(n.$t("select-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:a[1]||(a[1]=o=>C(!1))},l(n.$t("deselect-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:m.value!=n.$t("save"),onClick:j},l(m.value),9,ze)])):$("",!0),v.value?(s(),P(R,{key:1,documentValidations:y.value},null,8,["documentValidations"])):$("",!0)])],64))}});export{Ve as default};
