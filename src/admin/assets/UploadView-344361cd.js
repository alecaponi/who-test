import{d as U,c as d,a as e,t as l,F as b,e as y,f as _,o as s,g as q,u as A,r as F,w as M,b as N,h as P}from"./index-d5d2d800.js";import{_ as R}from"./ValidationCharts.vue_vue_type_script_setup_true_lang-4ab9e6f5.js";const O={key:0,class:"mx-auto w-full max-w-screen-lg table-fixed"},z={class:"border-b border-black"},L={class:"border-b border-black"},G=["href"],H={class:"flex flex-row items-center gap-2"},K=["id","checked","disabled","value"],Q=["for"],W=["href"],X={key:0},Y=["href"],Z={key:0},J={key:0,class:"inline h-6 align-bottom text-green-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},ee=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),te=[ee],oe={key:1,class:"inline h-6 align-bottom text-blue-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},ne=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),le=[ne],re={key:1,class:"inline h-6 align-bottom text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},se=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),ae=[se],de={key:1,class:"border-b border-black"},ie=e("td",null,null,-1),ue=e("td",null,null,-1),ce=U({__name:"UploadReport",props:{json:null},setup(V){const a="http://dev.who.bitnomos.eu/converter/download?path=";return(k,D)=>V.json.length>0?(s(),d("table",O,[e("thead",null,[e("tr",z,[e("th",null,l(k.$t("folder")),1),e("th",null,l(k.$t("main-file")),1),e("th",null,l(k.$t("child-file")),1)])]),e("tbody",null,[(s(!0),d(b,null,y(V.json,w=>(s(),d(b,null,[w.children.length>0?(s(!0),d(b,{key:0},y(w.children,h=>(s(),d("tr",L,[e("td",null,l(w.path),1),e("td",null,[e("a",{href:a+encodeURIComponent(h.path),target:"_blank",class:"text-blue-who"},l(h.name),9,G)]),e("td",null,[(s(!0),d(b,null,y(h.split,t=>{var f,v,$,x,B,j,S,o,r,n;return s(),d("div",H,[e("input",{type:"checkbox",id:t.path,class:"rounded text-blue-who focus:ring-0 disabled:opacity-50",checked:((v=(f=t.converted[0])==null?void 0:f.errors.validationErrors)==null?void 0:v.length)+((x=($=t.converted[0])==null?void 0:$.errors.semanticErrors)==null?void 0:x.length)==0,disabled:t.converted.length==0,value:(B=t.converted[0])==null?void 0:B.path},null,8,K),e("label",{for:t.path},[e("a",{href:a+encodeURIComponent(t.path),target:"_blank",class:"text-blue-who"},l(t.name),9,W),(j=t.converted[0])!=null&&j.name?(s(),d("span",X,[q(" - "),e("a",{href:a+encodeURIComponent(t.converted[0].path),target:"_blank",class:"text-blue-who"},l(t.converted[0].name),9,Y),((S=t.converted[0].errors.validationErrors)==null?void 0:S.length)==0||((o=t.converted[0].errors.semanticErrors)==null?void 0:o.length)==0?(s(),d("span",Z,[((r=t.converted[0].errors.validationErrors)==null?void 0:r.length)==0?(s(),d("svg",J,te)):_("",!0),((n=t.converted[0].errors.semanticErrors)==null?void 0:n.length)==0?(s(),d("svg",oe,le)):_("",!0)])):t.converted[0].errors.validationErrors?(s(),d("svg",re,ae)):_("",!0)])):_("",!0)],8,Q)])}),256))])]))),256)):(s(),d("tr",de,[e("td",null,l(w.path),1),ie,ue]))],64))),256))])])):_("",!0)}}),he={class:"text-center text-3xl font-bold"},pe=["onSubmit"],be={for:"documents"},fe=e("input",{class:"file:cursor-pointer file:rounded file:border-2 file:border-solid file:border-blue-who file:bg-blue-who file:px-5 file:py-1 file:font-bold file:text-white file:duration-200 file:ease-in-out file:hover:bg-white file:hover:text-blue-who",type:"file",id:"documents",name:"documents",accept:".zip",required:""},null,-1),ve={for:"format"},me={id:"format",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"format",required:""},ge=["value"],_e={for:"language"},we={id:"language",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"language",required:""},$e=e("option",{value:""},null,-1),ye=["value"],ke={for:"doctype"},xe={id:"doctype",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"doctype",required:""},Ee=["value"],Ce={class:"flex flex-row items-center gap-2"},Fe=e("input",{type:"checkbox",id:"split",class:"rounded text-blue-who focus:ring-0",name:"split",value:"true"},null,-1),Be={for:"split"},je=["disabled","value"],Se={class:"mx-auto max-w-screen-lg"},Te={key:0,class:"flex flex-row justify-center gap-2 p-4"},Ie=["disabled"],Ue=U({__name:"UploadView",setup(V){const{t:a}=A(),k={akn:"Akoma Ntoso"},D={ara:"العربية",deu:"Deutsch",eng:"English",spa:"Español",fre:"Français",por:"Português",rsu:"Русский",zho:"中文"},w={statement:"Statement"},h=F([]),t=F(a("upload")),f=F(a("save")),v=F(!1),$=F([]);function x(o){[...document.querySelectorAll("table input[type=checkbox]:not(:disabled)")].forEach(r=>r.checked=o)}function B(o){const r=[...document.querySelectorAll("table input[type=checkbox]:checked")].map(n=>n.value);if(r.length==0)alert(a("no-file-selected"));else{f.value=a("saving");const n=new FormData;n.append("path",r.toString()),fetch("http://dev.who.bitnomos.eu/converter/save",{method:"POST",body:n}).then(i=>{i.ok?alert(a("saving-completed")):i.json().then(m=>{alert(`${a("error-during-saving")}: ${m.message}`)}),f.value=a("save")})}}async function j(o,r,n){let i=0,m=0,T=0,g=0;h.value.forEach(E=>{E.children.forEach(C=>{m++})}),t.value=`${a("splitting")} (0/${m})`;for(const E of h.value)for(const C of E.children){const p=new FormData;p.append("path",C.path),p.append("language",r),await fetch("http://dev.who.bitnomos.eu/converter/split",{method:"POST",body:p}).then(u=>(i++,t.value=`${a("splitting")} (${i}/${m})`,u.ok?u.json():u.json().then(c=>{throw new Error(`Code: ${c.code}`)}))).then(u=>{g+=u.length,C.split=u}).catch(u=>{console.log(u)})}t.value=`${a("converting")} (0/${g})`;for(const E of h.value)for(const C of E.children)for(const p of C.split){const u=new FormData;u.append("path",p.path),u.append("to",o),u.append("language",r),u.append("doctype",n),await fetch("http://dev.who.bitnomos.eu/converter/convert",{method:"POST",body:u}).then(c=>c.json()).then(c=>{T++,t.value=`${a("converting")} (${T}/${g})`,c.code?console.error(`${p.path}: ${c.code} (${c.message})`):(p.converted.push(c),fetch("http://dev.who.bitnomos.eu/converter/validate?path="+encodeURIComponent(c.path)).then(I=>I.json()).then(I=>{p.converted[0].errors=I.errors,$.value.push({name:c.name,path:c.path,errors:I.errors})}))}).catch(c=>{console.log(c)})}t.value=a("upload"),v.value=!0}function S(o){t.value=a("uploading"),v.value=!1,$.value=[];const r=new FormData(o.target);r.delete("format"),r.delete("split");const n=document.getElementById("format").value,i=document.getElementById("language").value,m=document.getElementById("doctype").value,T=document.getElementById("split").checked;fetch("http://dev.who.bitnomos.eu/converter/upload",{method:"POST",body:r}).then(g=>g.json()).then(g=>{h.value=g,T?j(n,i,m):t.value=a("upload")})}return(o,r)=>(s(),d(b,null,[e("h1",he,l(o.$t("upload")),1),e("form",{class:"mx-auto flex max-w-md flex-col gap-2 p-4",onSubmit:M(S,["prevent"])},[e("label",be,l(o.$t("documents")),1),fe,e("label",ve,l(o.$t("upload-format")),1),e("select",me,[(s(),d(b,null,y(k,(n,i)=>e("option",{key:`format-${i}`,value:i},l(n),9,ge)),64))]),e("label",_e,l(o.$t("upload-language")),1),e("select",we,[$e,(s(),d(b,null,y(D,(n,i)=>e("option",{key:`language-${n}`,value:i},l(n),9,ye)),64))]),e("label",ke,l(o.$t("upload-doctype")),1),e("select",xe,[(s(),d(b,null,y(w,(n,i)=>e("option",{key:`doctype-${i}`,value:i},l(n),9,Ee)),64))]),e("div",Ce,[Fe,e("label",Be,l(o.$t("upload-split")),1)]),e("input",{class:"mx-auto rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:t.value!=o.$t("upload"),type:"submit",value:t.value},null,8,je)],40,pe),e("div",Se,[N(ce,{json:h.value},null,8,["json"]),v.value?(s(),d("div",Te,[e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:r[0]||(r[0]=n=>x(!0))},l(o.$t("select-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:r[1]||(r[1]=n=>x(!1))},l(o.$t("deselect-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:f.value!=o.$t("save"),onClick:B},l(f.value),9,Ie)])):_("",!0),v.value?(s(),P(R,{key:1,documentValidations:$.value},null,8,["documentValidations"])):_("",!0)])],64))}});export{Ue as default};
