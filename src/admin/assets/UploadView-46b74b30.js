import{d as D,c as d,a as e,t as l,F as b,e as y,f as w,o as s,g as U,u as q,r as F,w as A,b as M,h as N}from"./index-fe9f5ab2.js";import{_ as P}from"./ValidationCharts.vue_vue_type_script_setup_true_lang-4ce5d0e4.js";const R={key:0,class:"mx-auto w-full max-w-screen-lg table-fixed"},O={class:"border-b border-black"},L={class:"border-b border-black"},G=["href"],H={class:"flex flex-row items-center gap-2"},K=["id","checked","disabled","value"],Q=["for"],W=["href"],X={key:0},Y=["href"],Z={key:0},J={key:0,class:"inline h-6 align-bottom text-green-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},ee=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),te=[ee],oe={key:1,class:"inline h-6 align-bottom text-blue-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},ne=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),le=[ne],ae={key:1,class:"inline h-6 align-bottom text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},se=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),re=[se],de={key:1,class:"border-b border-black"},ie=e("td",null,null,-1),ue=e("td",null,null,-1),ce=D({__name:"UploadReport",props:{json:null},setup(z){const r="https://who-admin-backend.azurewebsites.net//download?path=";return(k,V)=>z.json.length>0?(s(),d("table",R,[e("thead",null,[e("tr",O,[e("th",null,l(k.$t("folder")),1),e("th",null,l(k.$t("main-file")),1),e("th",null,l(k.$t("child-file")),1)])]),e("tbody",null,[(s(!0),d(b,null,y(z.json,_=>(s(),d(b,null,[_.children.length>0?(s(!0),d(b,{key:0},y(_.children,h=>(s(),d("tr",L,[e("td",null,l(_.path),1),e("td",null,[e("a",{href:r+encodeURIComponent(h.path),target:"_blank",class:"text-blue-who"},l(h.name),9,G)]),e("td",null,[(s(!0),d(b,null,y(h.split,t=>{var f,m,$,x,B,j,S,o,a,n;return s(),d("div",H,[e("input",{type:"checkbox",id:t.path,class:"rounded text-blue-who focus:ring-0 disabled:opacity-50",checked:((m=(f=t.converted[0])==null?void 0:f.errors.validationErrors)==null?void 0:m.length)+((x=($=t.converted[0])==null?void 0:$.errors.semanticErrors)==null?void 0:x.length)==0,disabled:t.converted.length==0,value:(B=t.converted[0])==null?void 0:B.path},null,8,K),e("label",{for:t.path},[e("a",{href:r+encodeURIComponent(t.path),target:"_blank",class:"text-blue-who"},l(t.name),9,W),(j=t.converted[0])!=null&&j.name?(s(),d("span",X,[U(" - "),e("a",{href:r+encodeURIComponent(t.converted[0].path),target:"_blank",class:"text-blue-who"},l(t.converted[0].name),9,Y),((S=t.converted[0].errors.validationErrors)==null?void 0:S.length)==0||((o=t.converted[0].errors.semanticErrors)==null?void 0:o.length)==0?(s(),d("span",Z,[((a=t.converted[0].errors.validationErrors)==null?void 0:a.length)==0?(s(),d("svg",J,te)):w("",!0),((n=t.converted[0].errors.semanticErrors)==null?void 0:n.length)==0?(s(),d("svg",oe,le)):w("",!0)])):t.converted[0].errors.validationErrors?(s(),d("svg",ae,re)):w("",!0)])):w("",!0)],8,Q)])}),256))])]))),256)):(s(),d("tr",de,[e("td",null,l(_.path),1),ie,ue]))],64))),256))])])):w("",!0)}}),he={class:"text-center text-3xl font-bold"},pe=["onSubmit"],be={for:"documents"},fe=e("input",{class:"file:cursor-pointer file:rounded file:border-2 file:border-solid file:border-blue-who file:bg-blue-who file:px-5 file:py-1 file:font-bold file:text-white file:duration-200 file:ease-in-out file:hover:bg-white file:hover:text-blue-who",type:"file",id:"documents",name:"documents",accept:".zip",required:""},null,-1),me={for:"format"},ge={id:"format",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"format",required:""},ve=["value"],we={for:"language"},_e={id:"language",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"language",required:""},$e=e("option",{value:""},null,-1),ye=["value"],ke={for:"doctype"},xe={id:"doctype",class:"rounded focus:border-gray-500 focus:ring-0 focus:drop-shadow-md",name:"doctype",required:""},Ee=["value"],Ce={class:"flex flex-row items-center gap-2"},Fe=e("input",{type:"checkbox",id:"split",class:"rounded text-blue-who focus:ring-0",name:"split",value:"true"},null,-1),Be={for:"split"},je=["disabled","value"],Se={class:"mx-auto max-w-screen-lg"},Te={key:0,class:"flex flex-row justify-center gap-2 p-4"},Ie=["disabled"],De=D({__name:"UploadView",setup(z){const{t:r}=q(),k={akn:"Akoma Ntoso"},V={ara:"العربية",deu:"Deutsch",eng:"English",spa:"Español",fre:"Français",por:"Português",rsu:"Русский",zho:"中文"},_={statement:"Statement"},h=F([]),t=F(r("upload")),f=F(r("save")),m=F(!1),$=F([]);function x(o){[...document.querySelectorAll("table input[type=checkbox]:not(:disabled)")].forEach(a=>a.checked=o)}function B(o){const a=[...document.querySelectorAll("table input[type=checkbox]:checked")].map(n=>n.value);if(a.length==0)alert(r("no-file-selected"));else{f.value=r("saving");const n=new FormData;n.append("path",a.toString()),fetch("https://who-admin-backend.azurewebsites.net//save",{method:"POST",body:n}).then(i=>{i.ok?alert(r("saving-completed")):i.json().then(g=>{alert(`${r("error-during-saving")}: ${g.message}`)}),f.value=r("save")})}}async function j(o,a,n){let i=0,g=0,T=0,v=0;h.value.forEach(E=>{E.children.forEach(C=>{g++})}),t.value=`${r("splitting")} (0/${g})`;for(const E of h.value)for(const C of E.children){const p=new FormData;p.append("path",C.path),p.append("language",a),await fetch("https://who-admin-backend.azurewebsites.net//split",{method:"POST",body:p}).then(u=>(i++,t.value=`${r("splitting")} (${i}/${g})`,u.ok?u.json():u.json().then(c=>{throw new Error(`Code: ${c.code}`)}))).then(u=>{v+=u.length,C.split=u}).catch(u=>{console.log(u)})}t.value=`${r("converting")} (0/${v})`;for(const E of h.value)for(const C of E.children)for(const p of C.split){const u=new FormData;u.append("path",p.path),u.append("to",o),u.append("language",a),u.append("doctype",n),await fetch("https://who-admin-backend.azurewebsites.net//convert",{method:"POST",body:u}).then(c=>c.json()).then(c=>{T++,t.value=`${r("converting")} (${T}/${v})`,c.code?console.error(`${p.path}: ${c.code} (${c.message})`):(p.converted.push(c),fetch("https://who-admin-backend.azurewebsites.net//validate?path="+encodeURIComponent(c.path)).then(I=>I.json()).then(I=>{p.converted[0].errors=I.errors,$.value.push({name:c.name,path:c.path,errors:I.errors})}))}).catch(c=>{console.log(c)})}t.value=r("upload"),m.value=!0}function S(o){t.value=r("uploading"),m.value=!1,$.value=[];const a=new FormData(o.target);a.delete("format"),a.delete("split");const n=document.getElementById("format").value,i=document.getElementById("language").value,g=document.getElementById("doctype").value,T=document.getElementById("split").checked;fetch("https://who-admin-backend.azurewebsites.net//upload",{method:"POST",body:a}).then(v=>v.json()).then(v=>{h.value=v,T?j(n,i,g):t.value=r("upload")})}return(o,a)=>(s(),d(b,null,[e("h1",he,l(o.$t("upload")),1),e("form",{class:"mx-auto flex max-w-md flex-col gap-2 p-4",onSubmit:A(S,["prevent"])},[e("label",be,l(o.$t("documents")),1),fe,e("label",me,l(o.$t("upload-format")),1),e("select",ge,[(s(),d(b,null,y(k,(n,i)=>e("option",{key:`format-${i}`,value:i},l(n),9,ve)),64))]),e("label",we,l(o.$t("upload-language")),1),e("select",_e,[$e,(s(),d(b,null,y(V,(n,i)=>e("option",{key:`language-${n}`,value:i},l(n),9,ye)),64))]),e("label",ke,l(o.$t("upload-doctype")),1),e("select",xe,[(s(),d(b,null,y(_,(n,i)=>e("option",{key:`doctype-${i}`,value:i},l(n),9,Ee)),64))]),e("div",Ce,[Fe,e("label",Be,l(o.$t("upload-split")),1)]),e("input",{class:"mx-auto rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:t.value!=o.$t("upload"),type:"submit",value:t.value},null,8,je)],40,pe),e("div",Se,[M(ce,{json:h.value},null,8,["json"]),m.value?(s(),d("div",Te,[e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:a[0]||(a[0]=n=>x(!0))},l(o.$t("select-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who",onClick:a[1]||(a[1]=n=>x(!1))},l(o.$t("deselect-all")),1),e("button",{class:"rounded border-2 border-blue-who bg-blue-who px-5 py-1 font-bold text-white duration-200 ease-in-out hover:bg-white hover:text-blue-who disabled:cursor-wait disabled:border-gray-who disabled:bg-gray-who disabled:text-white",disabled:f.value!=o.$t("save"),onClick:B},l(f.value),9,Ie)])):w("",!0),m.value?(s(),N(P,{key:1,documentValidations:$.value},null,8,["documentValidations"])):w("",!0)])],64))}});export{De as default};
